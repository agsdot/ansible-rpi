---

- name: Install automount packages
  apt: state=installed pkg={{ item }}
  with_items:
    - samba
    - cifs-utils

- name: Create local devices folders
  file: dest=/mnt/{{ item.name }} state=directory
  with_items: "{{ automount_network_folders }}"

- name: Mount local devices by label
  mount:
    name: {{ item.name }}
    src: LABEL={{ item.label }}
    fstype: {{ item.type }}
    state: mounted
  with_items: "{{ automount_local_devices }}"

- name: Create remote folders
  file: dest=/media/{{ item.name }} state=directory
  with_items: "{{ automount_network_folders }}"

- name: Mount remote folders
  mount:
    name: {{ item.name }}
    src: {{ item.network_folder }}
    fstype: {{ item.type|default('cifs') }}
    opts: "domain={{ item.domain }},username={{ item.user }},password={{ item.password }},iocharset=utf8,uid={{ rpi_user_name }}"
    state: mounted
  with_items: "{{ automount_network_folders }}"
